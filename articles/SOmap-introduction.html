<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOmap-introduction • SOmap</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SOmap-introduction">
<meta property="og:description" content="SOmap">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SOmap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.2.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/SOmap-introduction.html">SOmap-introduction</a>
    </li>
    <li>
      <a href="../articles/many-automap-examples.html">many-automap-examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/AustralianAntarcticDivision/SOmap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SOmap-introduction</h1>
                        <h4 data-toc-skip class="author">Ben Raymond,
Michael Sumner, Dale Maschette, Anton Van de Putte</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AustralianAntarcticDivision/SOmap/blob/HEAD/vignettes/SOmap-introduction.Rmd" class="external-link"><code>vignettes/SOmap-introduction.Rmd</code></a></small>
      <div class="hidden name"><code>SOmap-introduction.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="somap-introduction">SOmap introduction<a class="anchor" aria-label="anchor" href="#somap-introduction"></a>
</h2>
<p>This vignette was adapted from the <a href="https://github.com/SCAR/EGABIcourse19" class="external-link">SCAR-EGABI Tools for
Southern Ocean Spatial Analysis and Modelling</a> course and <a href="https://github.com/Maschette/Mapping_in_R" class="external-link">Mapping in R</a>
workshop.</p>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<div class="section level3">
<h3 id="maps-in-r">Maps in R<a class="anchor" aria-label="anchor" href="#maps-in-r"></a>
</h3>
<p>The oldest and most <em>core</em> general mapping package in R is the
<code>maps</code> package. It has a simple whole-world coastline data
set for immediate use.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/maps-package-1.png" width="700"></p>
<p>The data underlying this live map is available by capturing the
output as an actual object. Notice that the coastline for Antarctica
does not extend to the south pole, and that parts of Russia that are
east of 180 longitude are not in the western part of the map.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lonlat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">x</span>, <span class="va">m</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lonlat</span>, pch <span class="op">=</span> <span class="st">"+"</span>, cex <span class="op">=</span> <span class="fl">0.4</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">lonlat</span>, col <span class="op">=</span> <span class="st">"dodgerblue"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span><span class="op">)</span>, v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/maps-assign-1.png" width="700"></p>
<div class="section level4">
<h4 id="exercises">Exercises<a class="anchor" aria-label="anchor" href="#exercises"></a>
</h4>
<ol style="list-style-type: decimal">
<li>How can we find the longitude and latitude ranges of the maps data
<code>m</code>?</li>
<li>Can we draw polygons with a fill colour with the maps package?</li>
</ol>
<p>Answer 1: <code>range(m$x, na.rm = TRUE)</code>
<code>range(m$y, na.rm = TRUE</code>) also <code>m$range</code></p>
<p>Answer 2: <code>polygon(lonlat, col = "grey")</code> does not work,
but <code>maps::map(fill = TRUE, col = "grey")</code> does seem to
work.</p>
<p>What’s going on? Look at the very south-eastern corner of the map.
The “coastline” has been extended to the very south boundary of the
available area.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">0</span>, type <span class="op">=</span> <span class="st">"n"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>, <span class="fl">180</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="op">-</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect</a></span><span class="op">(</span>xleft <span class="op">=</span> <span class="op">-</span><span class="fl">180</span>, ybottom <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, xright <span class="op">=</span> <span class="fl">180</span>, ytop <span class="op">=</span> <span class="fl">90</span>, border <span class="op">=</span> <span class="st">"darkred"</span>, lwd <span class="op">=</span> <span class="fl">4</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span>add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"dodgerblue"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/south-east-1.png" width="700"></p>
<p>The old maps coastline does not extend to 90S and it does not
traverse the southern boundary.</p>
<p>One reason for this is that if we choose a projection where the east
and west edges of the Antarctic coastline meet then we get what looks a
fairly clean join.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## scale factor</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">3e6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">lonlat</span>, to <span class="op">=</span> <span class="st">"+proj=laea +lat_0=-90 +datum=WGS84"</span>, from <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">f</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">f</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/laea-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="lets-use-the-maps-data">Let’s use the maps data!<a class="anchor" aria-label="anchor" href="#lets-use-the-maps-data"></a>
</h4>
<p>In <code>m</code> we have the maps data structure, and this looks
promising.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ x    : num [1:82403] -69.9 -69.9 -69.9 -70 -70.1 ...</span></span>
<span><span class="co">#&gt;  $ y    : num [1:82403] 12.5 12.4 12.4 12.5 12.5 ...</span></span>
<span><span class="co">#&gt;  $ range: num [1:4] -180 190.3 -85.2 83.6</span></span>
<span><span class="co">#&gt;  $ names: chr [1:1627] "Aruba" "Afghanistan" "Angola" "Angola:Cabinda" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "map"</span></span>
<span></span>
<span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="va">m</span></span>
<span><span class="va">pxy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">lonlat</span>, to <span class="op">=</span> <span class="st">"+proj=laea +lat_0=-90 +datum=WGS84"</span>, from <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span><span class="va">mp</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">pxy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mp</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">pxy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">mp</span><span class="op">$</span><span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mp</span><span class="op">$</span><span class="va">x</span>,na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mp</span><span class="op">$</span><span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mp</span><span class="op">$</span><span class="va">range</span></span>
<span><span class="co">#&gt; [1] -12709814  12704237 -12576156  12470787</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">f</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">f</span>, type <span class="op">=</span> <span class="st">"n"</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">mp</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/maps-data-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co">## but it doesn't take much to go awry</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">f</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">f</span>, type <span class="op">=</span> <span class="st">"n"</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">mp</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/maps-data-2.png" width="700"></p>
<p>The problem is that the maps database has enough internal structure
to join lines correctly, with <code>NA</code> gaps between different
connected linestrings, but not enough to draw these things as polygons.
A similar problem occurs in the default projection.</p>
<p>We have to look quite carefully to understand what is happening, but
this is wrapping around overlapping itself and so close to the southern
bound we barely notice.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">0</span>, type <span class="op">=</span> <span class="st">"n"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="op">-</span><span class="fl">110</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="op">-</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect</a></span><span class="op">(</span>xleft <span class="op">=</span> <span class="op">-</span><span class="fl">180</span>, ybottom <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, xright <span class="op">=</span> <span class="fl">180</span>, ytop <span class="op">=</span> <span class="fl">90</span>, border <span class="op">=</span> <span class="st">"darkred"</span>, lwd <span class="op">=</span> <span class="fl">4</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span>add <span class="op">=</span> <span class="cn">TRUE</span>,col <span class="op">=</span> <span class="st">"grey"</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/no-pole-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey"</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/no-pole-2.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">mpmerc</span> <span class="op">&lt;-</span> <span class="va">m</span></span>
<span><span class="va">pxy</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">lonlat</span>, to <span class="op">=</span> <span class="st">"+proj=merc +datum=WGS84"</span>, from <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span><span class="va">mpmerc</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">pxy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mpmerc</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">pxy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">mpmerc</span><span class="op">$</span><span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mpmerc</span><span class="op">$</span><span class="va">x</span>,na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mpmerc</span><span class="op">$</span><span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mpmerc</span><span class="op">$</span><span class="va">range</span></span>
<span><span class="co">#&gt; [1] -20037508  20037508 -20179524  18351859</span></span>
<span></span>
<span><span class="co">## the catastrophe made a little clearer </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">0</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mpmerc</span><span class="op">$</span><span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mpmerc</span><span class="op">$</span><span class="va">range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">mpmerc</span>,  fill <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"grey"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/no-pole-3.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="somap">SOmap<a class="anchor" aria-label="anchor" href="#somap"></a>
</h2>
<p>The <code>SOmap</code> package is intended to solve some of these
problems, and provide an easier way to produce nice-looking maps of
Antarctica and the Southern Ocean. It is primarily focused on maps in
polar stereographic projection (although the <code>SOmap_auto</code>
function extends this to other projections). <code>SOmap</code> won’t
necessarily get you exactly the map you want in every circumstance, but
the idea is that in most cases it should get you close enough, and if
need be you can make modifications to suit your exact purposes.</p>
<p>Please bear in mind that <code>SOmap</code> is still in development,
and so its functionality (function parameters and/or behaviour) may
change.</p>
<p>By default, <code>SOmap</code> works with base graphics (and
associated functionality from packages such as <code>raster</code> and
<code>sp</code>). It is also possible to work with
<code>ggplot2</code>-based graphics, as described below.</p>
<p>Start by installing the <code>SOmap</code> package if you haven’t
done so already:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"AustralianAntarcticDivision/SOmap"</span><span class="op">)</span></span></code></pre></div>
<p>Then load the package:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AustralianAntarcticDivision/SOmap" class="external-link">SOmap</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: raster</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="co">## also define a colour map to use for some examples</span></span>
<span><span class="va">my_cmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#4D4140"</span>, <span class="st">"#596F7E"</span>, <span class="st">"#168B98"</span>, <span class="st">"#ED5B67"</span>,</span>
<span>                              <span class="st">"#E27766"</span>, <span class="st">"#DAAD50"</span>, <span class="st">"#EAC3A6"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">51</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="circumpolar-maps">Circumpolar maps<a class="anchor" aria-label="anchor" href="#circumpolar-maps"></a>
</h4>
<p>A basic circumpolar map in polar stereographic projection. Here we
save our map to the <code>base_plot</code> variable, so that we can use
it again later without re-generating the map from scratch each time:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOmap.html">SOmap</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap1-1.png" width="700"></p>
<p><code><a href="../reference/SOmanagement.html">SOmanagement()</a></code> provides a number of contextual layers
such as MPA boundaries and management zones.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOmap.html">SOmap</a></span><span class="op">(</span>trim <span class="op">=</span> <span class="op">-</span><span class="fl">40</span><span class="op">)</span> <span class="co">## plot to 40S</span></span>
<span><span class="co">## add the exclusive economic zones management layer</span></span>
<span><span class="fu"><a href="../reference/SOmanagement.html">SOmanagement</a></span><span class="op">(</span>eez <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap2-1.png" width="700"></p>
<div class="section level5">
<h5 id="adding-points">Adding points<a class="anchor" aria-label="anchor" href="#adding-points"></a>
</h5>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## some longitude/latitude data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="va">my_points_ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">350</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, lat <span class="op">=</span> <span class="op">-</span><span class="fl">55</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">36</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">my_points_ll</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html" class="external-link">projection</a></span><span class="op">(</span><span class="va">my_points_ll</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84"</span></span></code></pre></div>
<p>Our data need to be reprojected to match our map before plotting. The
<code>SOproj</code> function does this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## reproject to our SOmap projection</span></span>
<span><span class="va">my_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOproj.html">SOproj</a></span><span class="op">(</span><span class="va">my_points_ll</span><span class="op">)</span></span>
<span><span class="co">## and plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_points</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_pts2-1.png" width="700"></p>
<p>Or use <code>SOplot</code> to reproject and plot in one step:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">my_points_ll</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_pts3-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="adding-raster-layers">Adding raster layers<a class="anchor" aria-label="anchor" href="#adding-raster-layers"></a>
</h5>
<p>First let’s construct some artificial raster data (in
longitude-latitude space) for demonstration purposes:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">140</span>, by <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>                                  lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">65</span>, <span class="op">-</span><span class="fl">45</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">lon</span> <span class="op">-</span> <span class="fl">120</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span> <span class="op">+</span> <span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">lat</span> <span class="op">-</span> <span class="op">-</span><span class="fl">40</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## create raster object</span></span>
<span><span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html" class="external-link">rasterFromXYZ</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html" class="external-link">projection</a></span><span class="op">(</span><span class="va">xr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84"</span></span></code></pre></div>
<p><code>SOplot</code> will reproject and plot this for us:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_raster2-1.png" width="700"></p>
<p>The legend is out of character with the rest of the map. We can use
<code>SOleg</code> to fix that:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## draw the base map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="co">## add our raster</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">my_cmap</span><span class="op">)</span></span>
<span><span class="co">## add the legend</span></span>
<span><span class="fu"><a href="../reference/SOleg.html">SOleg</a></span><span class="op">(</span><span class="va">xr</span>, position <span class="op">=</span> <span class="st">"topright"</span>, col <span class="op">=</span> <span class="va">my_cmap</span>, ticks <span class="op">=</span> <span class="fl">6</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"continuous"</span>, label <span class="op">=</span> <span class="st">"My variable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_raster3-1.png" width="700"></p>
<p>OK, well that worked but clearly the labels need tidying up. The
easiest way is probably to set the number of decimal places in the label
values via the <code>rnd</code> parameter:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">my_cmap</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOleg.html">SOleg</a></span><span class="op">(</span><span class="va">xr</span>, position <span class="op">=</span> <span class="st">"topright"</span>, col <span class="op">=</span> <span class="va">my_cmap</span>, ticks <span class="op">=</span> <span class="fl">6</span>, rnd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"continuous"</span>, label <span class="op">=</span> <span class="st">"My variable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_raster4rnd-1.png" width="700"></p>
<p>Alternatively, we could explicitly set the colour range and
labels.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## draw the base map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="co">## add our raster, controlling the colour range to span the values 0 to 30</span></span>
<span><span class="va">colour_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">my_cmap</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">my_cmap</span>, breaks <span class="op">=</span> <span class="va">colour_breaks</span><span class="op">)</span></span>
<span><span class="co">## add the legend, again controlling the colour range</span></span>
<span><span class="va">label_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, length.out <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOleg.html">SOleg</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"topright"</span>, col <span class="op">=</span> <span class="va">my_cmap</span>, breaks <span class="op">=</span> <span class="va">label_breaks</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"continuous"</span>, label <span class="op">=</span> <span class="st">"My variable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_raster4-1.png" width="700"></p>
<p>Note that if we <em>don’t</em> want to show the bathymetric legend,
we may run into problems:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOmap.html">SOmap</a></span><span class="op">(</span>bathy_legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">## suppress the bathy legend</span></span>
<span><span class="fu"><a href="../reference/SOleg.html">SOleg</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"topright"</span>, col <span class="op">=</span> <span class="va">my_cmap</span>, breaks <span class="op">=</span> <span class="va">label_breaks</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"continuous"</span>, label <span class="op">=</span> <span class="st">"My variable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_legend1-1.png" width="700"></p>
<p>The legend has been chopped off because the layout has not left
enough space around the map for the curved legend. There are a couple of
ways around this. The elegant way is to specify
<code>bathy_legend = "space"</code>, which will leave appropriate space
for a bathymetry legend but not actually plot it. This will also have
the effect of leaving adequate space for other legends:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOmap.html">SOmap</a></span><span class="op">(</span>bathy_legend <span class="op">=</span> <span class="st">"space"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOleg.html">SOleg</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"topright"</span>, col <span class="op">=</span> <span class="va">my_cmap</span>, breaks <span class="op">=</span> <span class="va">label_breaks</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"continuous"</span>, label <span class="op">=</span> <span class="st">"My variable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_legend2-1.png" width="700"></p>
<p>The second, rather hackier way is to generate the <code>SOmap</code>
object <em>with</em> the bathymetric legend, but then remove the
bathymetric legend before plotting:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">base_map</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy_legend</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co">## remove the bathy legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOleg.html">SOleg</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"topright"</span>, col <span class="op">=</span> <span class="va">my_cmap</span>, breaks <span class="op">=</span> <span class="va">label_breaks</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"continuous"</span>, label <span class="op">=</span> <span class="st">"My variable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_legend3-1.png" width="700"></p>
<p>See the <a href="#modifying-map-objects-advanced-usage">Modifying map
objects</a> section below for more details on modifying map objects.</p>
<p>Multiple rasters:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xr2</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">xr</span>, <span class="op">-</span><span class="fl">70</span><span class="op">)</span> <span class="co">## offset in longitude</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">my_cmap</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr2</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="va">my_cmap</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap_raster5-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="create-a-raster-from-points">Create a raster from points<a class="anchor" aria-label="anchor" href="#create-a-raster-from-points"></a>
</h5>
<p>Let’s say that we have a large number of points that we wish to add
to the map. We could simply add them:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, min <span class="op">=</span> <span class="fl">30</span>, max <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>, lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">points</span><span class="op">$</span><span class="va">lon</span>, y <span class="op">=</span> <span class="va">points</span><span class="op">$</span><span class="va">lat</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/sobin1-1.png" width="700"></p>
<p>However, the overlap of the points reduces the utility of the map.
One option is to create a density layer, showing the number of points
that fall into each cell of a raster grid. The <code>SObin</code>
function can do this for us:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SObin.html">SObin</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">points</span><span class="op">$</span><span class="va">lon</span>, y <span class="op">=</span> <span class="va">points</span><span class="op">$</span><span class="va">lat</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"Viridis"</span><span class="op">)</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/sobin2-1.png" width="700"></p>
</div>
</div>
<div class="section level4">
<h4 id="non-circumpolar-maps">Non-circumpolar maps<a class="anchor" aria-label="anchor" href="#non-circumpolar-maps"></a>
</h4>
<p>The <code>SOmap_auto</code> function will take your input data and
make a guess at an appropriate projection and extent to use. Note that
this is not always going to guess the <em>best</em> projection and
extent, so you should view it as a starting point from which you can
generate a map to your exact requirements.</p>
<p>Use the elephant seal track data bundled with the package:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ellie</span> <span class="op">&lt;-</span> <span class="va">SOmap_data</span><span class="op">$</span><span class="va">mirounga_leonina</span></span>
<span><span class="co">## construct and plot the map</span></span>
<span><span class="fu"><a href="../reference/SOmap_auto.html">SOmap_auto</a></span><span class="op">(</span><span class="va">ellie</span><span class="op">$</span><span class="va">lon</span>, <span class="va">ellie</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/soauto1-1.png" width="700"></p>
<p>Just a blank map to which you could add other things:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOmap_auto.html">SOmap_auto</a></span><span class="op">(</span><span class="va">ellie</span><span class="op">$</span><span class="va">lon</span>, <span class="va">ellie</span><span class="op">$</span><span class="va">lat</span>, input_points <span class="op">=</span> <span class="cn">FALSE</span>, input_lines <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/soauto2-1.png" width="700"></p>
<p>You can pass a raster as input data, but note that it won’t plot the
raster (it uses its extent to infer an appropriate extent for the
map):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOmap_auto.html">SOmap_auto</a></span><span class="op">(</span><span class="va">xr</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/soauto3-1.png" width="700"></p>
<p>But we can add the raster if we wish:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOmap_auto.html">SOmap_auto</a></span><span class="op">(</span><span class="va">xr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr</span>, col <span class="op">=</span> <span class="va">my_cmap</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/soauto4-1.png" width="700"></p>
<p>We can force a particular projection:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOmap_auto.html">SOmap_auto</a></span><span class="op">(</span><span class="va">xr</span>, target <span class="op">=</span> <span class="st">"laea"</span>, centre_lon <span class="op">=</span> <span class="fl">147</span>, centre_lat <span class="op">=</span> <span class="op">-</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr</span>, col <span class="op">=</span> <span class="va">my_cmap</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/soauto5-1.png" width="700"></p>
<p>Same but by supplying a full proj4 string to <code>target</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOmap_auto.html">SOmap_auto</a></span><span class="op">(</span><span class="va">xr</span>, target <span class="op">=</span> <span class="st">"+proj=laea +lat_0=-42 +lon_0=147"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/SOplot.html">SOplot</a></span><span class="op">(</span><span class="va">xr</span>, col <span class="op">=</span> <span class="va">my_cmap</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/soauto6-1.png" width="700"></p>
<p>See <a href="https://australianantarcticdivision.github.io/SOmap/articles/many-automap-examples.html" class="external-link">the
SOmap_auto vignette</a> for more examples.</p>
</div>
<div class="section level4">
<h4 id="plotting-via-ggplot2">Plotting via ggplot2<a class="anchor" aria-label="anchor" href="#plotting-via-ggplot2"></a>
</h4>
<p>The <code>SOmap</code> and <code>SOmap_auto</code> functions do their
plotting using base graphics. If you are more comfortable working with
<code>ggplot2</code>, this is also possible. The <code>SOgg</code>
function takes an object created by one of those functions (using base
graphics) and converts it to use <code>ggplot2</code> graphics instead.
As with other <code>SOmap</code> functions, this returns an object (of
class <code>SOmap_gg</code> or <code>SOmap_auto_gg</code>) that contains
all of the information needed to generate the map. Printing or plotting
this object will cause it to construct a <code>ggplot</code> object.
Printing or plotting <em>that</em> object will cause it to be drawn to
the graphics device, just like any other <code>ggplot</code> object.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myplotgg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOgg.html">SOgg</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span> <span class="co">## creates a SOmap_gg object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">myplotgg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "SOmap_gg"</span></span>
<span><span class="va">my_ggplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myplotgg</span><span class="op">)</span> <span class="co">## creates a ggplot object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">my_ggplot</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "gg"     "ggplot"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_ggplot</span><span class="op">)</span> <span class="co">## plot it</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap3-1.png" width="700"></p>
<p>Or in one step (this will cause myplot to be converted to SOmap’s
internal gg format, then a ggplot object constructed from that, then
that object will be plotted):</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SOgg.html">SOgg</a></span><span class="op">(</span><span class="va">base_map</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap4-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="modifying-map-objects-advanced-usage">Modifying map objects (advanced usage)<a class="anchor" aria-label="anchor" href="#modifying-map-objects-advanced-usage"></a>
</h4>
<p>The goal of <code>SOmap</code> is to make it fairly easy to produce a
fairly-good-looking map that will be adequate for most mapping
requirements. It will never be possible to automatically produce a
<em>perfect</em> map in <em>every circumstance</em>, but the aim is to
have a low-effort way of getting fairly close most of the time.</p>
<p>This section describes some approaches to modifying a map to get it
closer to your particular needs. Be warned: depending on the exact
modifications needed, this might get you pretty close to the crumbling
edge of <code>SOmap</code> development. In particular, anything that
requires modifying the internal structure of an <code>SOmap</code>
object may change in the future (with luck, we’ll make this sort of
thing easier - but we’re not there yet.)</p>
<div class="section level5">
<h5 id="modifying-base-graphics-maps">Modifying base graphics maps<a class="anchor" aria-label="anchor" href="#modifying-base-graphics-maps"></a>
</h5>
<p>Calls to <code><a href="../reference/SOmap.html">SOmap()</a></code>, <code><a href="../reference/SOmanagement.html">SOmanagement()</a></code>,
<code><a href="../reference/SOmap_auto.html">SOmap_auto()</a></code> return an object of class <code>SOmap</code>,
<code>SOmap_management</code>, or <code>SOmap_auto</code>. These objects
contain all of the data and plotting instructions required to draw the
map. Calling <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> or <code><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot()</a></code> on one of these
objects will cause that code to be executed, and the object to be drawn
in the current graphics device. Hence, calling <code><a href="../reference/SOmap.html">SOmap()</a></code>
directly <em>without</em> assigning the result to a variable will make
it appear in the graphics device, because the returned object is being
printed to the console (and thus triggering the <code>print</code>
method). But you can also assign the result to a variable,
e.g. <code>myplot &lt;- SOmap()</code> and then explicitly plot the
object with <code>plot(myplot)</code>. The advantage of this is that you
can potentially manipulate the <code>myplot</code> object to make
changes to the map before plotting it.</p>
<p>Note, this is likely to be fragile. Proceed at your own risk!</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mymap</span> <span class="op">&lt;-</span> <span class="va">base_map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mymap</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "projection"    "target"        "straight"      "trim"         </span></span>
<span><span class="co">#&gt;  [5] "bathy"         "box"           "plot_sequence" "coastline"    </span></span>
<span><span class="co">#&gt;  [9] "ice"           "outer_mask"    "bathy_legend"  "border"</span></span></code></pre></div>
<p>The object contains a <code>plot_sequence</code> component, which
defines the order in which each part of the plot is drawn. The other
components of the object contain the code required to draw each part.
Take e.g. the ice component (this is the ice shelves, glacier tongues,
etc). This is a list (in this case with only one element). Each element
of the list is an object of class <code>SO_plotter</code>, which is a
SOmap-specific object that specifies a function to run along with
arguments to pass to it:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mymap</span><span class="op">$</span><span class="va">ice</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ :List of 2</span></span>
<span><span class="co">#&gt;   ..$ plotfun : chr "plot"</span></span>
<span><span class="co">#&gt;   ..$ plotargs:List of 4</span></span>
<span><span class="co">#&gt;   .. ..$ x     :sfc_POLYGON of length 354; first list element: List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ : num [1:5, 1:2] 1026000 1021994 1021935 1022981 1026000 ...</span></span>
<span><span class="co">#&gt;   .. .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"</span></span>
<span><span class="co">#&gt;   .. ..$ col   : logi NA</span></span>
<span><span class="co">#&gt;   .. ..$ border: chr "black"</span></span>
<span><span class="co">#&gt;   .. ..$ add   : logi TRUE</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr "SO_plotter"</span></span></code></pre></div>
<p>We can modify the function and/or its arguments:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mymap</span><span class="op">$</span><span class="va">ice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotargs</span><span class="op">$</span><span class="va">col</span> <span class="op">&lt;-</span> <span class="st">"green"</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mymap</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap2d-1.png" width="700"></p>
<p>We can remove entire components, either by setting the component to
<code>NULL</code> or removing its name from the
<code>plot_sequence</code>:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">mymap</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">coastline</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co">## set the coastline object to NULL</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">plot_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">plot_sequence</span>, <span class="st">"ice"</span><span class="op">)</span> <span class="co">## remove "ice" from plot_sequence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="co">## map without coastline or ice shown</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap2e-1.png" width="700"></p>
<p>But note that some elements are required. In particular, the
bathymetry layer can’t currently be removed because the code that draws
this is also the code that creates the plot page via
<code><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new()</a></code>. The code below would fail outright if there was
no existing existing plot. If there was an existing plot in the graphics
device, this code would run but give unpredictable results because it
would draw on top of the previously-setup plot:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## code not run here</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">mymap</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p>One way around this would be to simply replace all of the bathymetric
data values with <code>NA</code>s. The plotting code would still have
the extent of the bathymetric layer that it needs in order to set up the
plot, but no data would be shown:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">mymap</span></span>
<span><span class="co">## the bathy data is held in temp$bathy[[1]]$plotargs$x</span></span>
<span><span class="co">## and it's a raster, so we can set its values to NA with</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">bathy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotargs</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA_real_</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy_legend</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap2h2-1.png" width="700"></p>
<p>We could also replace the bathymetry data with another raster object.
Note that we do need to be careful about the extent and projection of
this raster. For example, replacing the bathymetry raster with the ice
raster (which has the same polar stereographic projection but smaller
extent) gives:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">mymap</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotargs</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">ice</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy_legend</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap2g-1.png" width="700"></p>
<p>It’s chopped off because the extent of the ice raster is being used
to set the plot extent. But if we extend the ice raster to match the map
extent:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">mymap</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotargs</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extend.html" class="external-link">extend</a></span><span class="op">(</span><span class="va">ice</span>, <span class="va">mymap</span><span class="op">$</span><span class="va">target</span><span class="op">)</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy_legend</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap2h-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="combining-map-objects">Combining map objects<a class="anchor" aria-label="anchor" href="#combining-map-objects"></a>
</h5>
<p>A new function in SOmap version 0.6 is <code>SOmerge</code>, which
can take separate objects and combine them into a single map. For
example:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mymap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOmap.html">SOmap</a></span><span class="op">(</span>bathy_legend <span class="op">=</span> <span class="st">"space"</span><span class="op">)</span></span>
<span><span class="va">mylegend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOleg.html">SOleg</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"topright"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">80</span>, <span class="st">"Viridis"</span><span class="op">)</span>,</span>
<span>                  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>, trim <span class="op">=</span> <span class="op">-</span><span class="fl">45</span>, label <span class="op">=</span> <span class="st">"Thing"</span>,</span>
<span>                  rnd <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span></span>
<span><span class="va">mymgmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOmanagement.html">SOmanagement</a></span><span class="op">(</span>eez <span class="op">=</span> <span class="cn">TRUE</span>, basemap <span class="op">=</span> <span class="va">mymap</span><span class="op">)</span></span>
<span><span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SOmerge.html">SOmerge</a></span><span class="op">(</span><span class="va">mymap</span>, <span class="va">mymgmt</span>, <span class="va">mylegend</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somerge1-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="modifying-ggplot-maps">Modifying ggplot maps<a class="anchor" aria-label="anchor" href="#modifying-ggplot-maps"></a>
</h5>
<p>We can modify <code>ggplot2</code>-based maps at two levels.</p>
<div class="section level6">
<h6 id="modifying-the-ggplot-object-">Modifying the <code>ggplot</code> object.<a class="anchor" aria-label="anchor" href="#modifying-the-ggplot-object-"></a>
</h6>
<p>Remember that printing or plotting a <code>SOmap_gg</code> object
produces a <code>ggplot</code> object. This can be modified by adding
e.g. layers or themes just like a normal <code>ggplot</code>. Remember
to load the <code>ggplot2</code> library now that we are using
<code>ggplot2</code> functions directly.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">my_ggplot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">my_points</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">coords.x1</span>, <span class="va">coords.x2</span>, colour <span class="op">=</span> <span class="va">z</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap6-1.png" width="700"></p>
<p>Multiple rasters or multiple sets of points gets tricky if they are
on different scales, because <code>ggplot2</code> is only designed to
work with a single colour scale per geometry type. However, the
<code>ggnewscale</code> package can be used to add multiple fill or
colour scales.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eliocamp.github.io/ggnewscale/" class="external-link">ggnewscale</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/SOgg.html">SOgg</a></span><span class="op">(</span><span class="fu"><a href="../reference/SOmap.html">SOmap</a></span><span class="op">(</span>straight <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://eliocamp.github.io/ggnewscale/reference/new_scale.html" class="external-link">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/SOproj.html">SOproj</a></span><span class="op">(</span><span class="va">xr</span><span class="op">)</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="va">my_cmap</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, name <span class="op">=</span> <span class="st">"My variable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap5g-1.png" width="700"></p>
</div>
<div class="section level6">
<h6 id="modifying-the-somap_gg-object">Modifying the <code>SOmap_gg</code> object<a class="anchor" aria-label="anchor" href="#modifying-the-somap_gg-object"></a>
</h6>
<p><code>SOmap_gg</code> objects are similar in structure to
<code>SOmap</code> objects, in that they contain all of the data and
plotting instructions required to draw the map:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">myplotgg</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "projection"    "target"        "straight"      "trim"         </span></span>
<span><span class="co">#&gt;  [5] "init"          "bathy"         "coord"         "plot_sequence"</span></span>
<span><span class="co">#&gt;  [9] "scale_fill"    "bathy_legend"  "coastline"     "ice"          </span></span>
<span><span class="co">#&gt; [13] "axis_labels"   "theme"         "border"</span></span></code></pre></div>
<p>However, instead of base plotting functions, <code>SOmap_gg</code>
objects use <code>ggplot2</code> function calls, e.g.:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myplotgg</span><span class="op">$</span><span class="va">ice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotfun</span></span>
<span><span class="co">#&gt; [1] "ggplot2::geom_sf"</span></span></code></pre></div>
<p>We can modify these functions and/or arguments in a similar manner to
<code>SOmap</code> objects.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myplotgg</span><span class="op">$</span><span class="va">ice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotargs</span><span class="op">$</span><span class="va">fill</span> <span class="op">&lt;-</span> <span class="st">"green"</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myplotgg</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap5c-1.png" width="700"></p>
<p>Or remove the bathymetric raster layer:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">myplotgg</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy_legend</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap5d-1.png" width="700"></p>
<p>Or replace it with a different raster (use the <code>ice</code>
raster as an example):</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">myplotgg</span></span>
<span><span class="co">## convert ice raster to suitable data.frame</span></span>
<span><span class="va">ice_raster_as_df</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/SOproj.html">SOproj</a></span><span class="op">(</span><span class="va">ice</span><span class="op">)</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ice_raster_as_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"ice"</span></span>
<span><span class="co">## add this to our object in place of bathy</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SO_plotter.html">SO_plotter</a></span><span class="op">(</span>plotfun <span class="op">=</span> <span class="st">"ggplot2::geom_raster"</span>,</span>
<span>                         plotargs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ice_raster_as_df</span>,</span>
<span>                                         mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html" class="external-link">aes_string</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"ice"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## change the colour scale</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">scale_fill</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">plotargs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">my_cmap</span>, na.value <span class="op">=</span> <span class="st">"#FFFFFF00"</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="co">## remove the bathy legend</span></span>
<span><span class="va">temp</span><span class="op">$</span><span class="va">bathy_legend</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p><img src="SOmap-introduction_files/figure-html/somap5e-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level4">
<h4 id="other-somap-gotchas">Other SOmap gotchas<a class="anchor" aria-label="anchor" href="#other-somap-gotchas"></a>
</h4>
<p>Some other things worth noting.</p>
<div class="section level5">
<h5 id="automatic-printing-and-for-loops">Automatic printing and for-loops<a class="anchor" aria-label="anchor" href="#automatic-printing-and-for-loops"></a>
</h5>
<p>If you type a variable/object name directly into the console then it
triggers that object’s <code>print</code> method automatically. Typing
<code><a href="../reference/SOmap.html">SOmap()</a></code> at the console returns an object of class
<code>SOmap</code>, and because it’s happening at the console that
object’s <code>print</code> method is called, which causes the map to be
plotted in the current graphics device.</p>
<p>However, R turns off automatic printing inside <code>for</code> loops
and functions. So this code:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/SOmap_auto.html">SOmap_auto</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>won’t produce anything, because the <code>print</code> method never
gets called. If you are generating maps using loops, you will need to
explicitly call the <code>print</code> method:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/SOmap_auto.html">SOmap_auto</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="supporting-data-for-maps">Supporting data for maps<a class="anchor" aria-label="anchor" href="#supporting-data-for-maps"></a>
</h3>
<p>When constructing maps, we commonly want to show features like
oceanographic fronts, ice extent, coastline, place names, and MPA
boundaries. There are a few sources of such data:</p>
<ul>
<li>some layers are bundled into <code>SOmap</code>, see the
<code><a href="../reference/SOmap_data.html">SOmap::SOmap_data</a></code> object</li>
<li>
<a href="https://github.com/ropensci/antanym" class="external-link">antanym</a> provides
access to the SCAR Composite Gazetteer of place names</li>
<li>the <a href="https://github.com/SCAR-sandpit/quantarcticR" class="external-link">quantarcticR</a>
package provides access to <a href="http://quantarctica.npolar.no/" class="external-link">Quantarctica</a> data layers.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Dale Maschette, Michael Sumner, Ben Raymond.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
